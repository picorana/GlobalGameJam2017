<html>
<head>
  <meta charset="UTF-8">
  <script language="javascript" type="text/javascript" src="libraries/p5.js"></script>
  <!-- uncomment lines below to include extra p5 libraries -->
  <!--<script language="javascript" src="libraries/p5.dom.js"></script>-->
  <!--<script language="javascript" src="libraries/p5.sound.js"></script>-->
  <!-- this line removes any default padding and style. you might only need one of these values set. -->
  <style> body {padding: 0; margin: 0;} </style>
</head>
<body>

  <script language="javascript" type="text/javascript">

function Wave(x, y){
  this.x=x
  this.y=y
  this.wave=new Array(x*y)
  for(var i=0; i< this.wave.length; ++i)
    this.wave[i]={p:0, p_:0, a:0}

  this.p=function (x, y){
    return this.wave[y + x*this.y]
  }

}

var wave

var w = 800
var h = 600

var lasttime
function setup() {
  createCanvas(w, h);

  wave=new Wave(70, 70)

  wave.p(10, 10).p=10

  wave.p(30, 5).p=70
  wave.p(10, 30).p= -40

  lastime=millis()
}



function draw() {
  if(keyIsDown(LEFT_ARROW)){ 
    var x=Math.floor(0.1*wave.x)
    for(var y=Math.floor(0.3*wave.y); y<Math.ceil(0.7*wave.y); ++y){
      wave.p(x, y).p+=15
    }
  }
  if(keyIsDown(RIGHT_ARROW)){
    var x=Math.floor(0.9*wave.x)
    for(var y=Math.floor(0.3*wave.y); y<Math.ceil(0.7*wave.y); ++y){
      wave.p(x, y).p+=15
    }
    }
//  console.log(keyCode)

  clear()
//  var dt=(millis()-lastime)/100
  var dt=0.4
  lastime=millis()

  if(key)

  for(var i in wave.wave){
    var e=wave.wave[i]
    var pn=1.99*e.p - 0.99*e.p_ + e.a*dt*dt
    e.p_ = e.p
    e.p  = pn
  }
  
  for(var x=0; x<wave.x; x++){
    for(var y=0; y<wave.y; y++){
      var e=wave.p(x, y)

      var eux = (x==0)? x+1: x-1 
      var euy = y
      var eu = wave.p(eux, euy)    
      
      var edx = (x==wave.x-1)? x-1: x+1
      var edy = y
      var ed = wave.p(edx, edy)

      var elx = x
      var ely = (y==0)? y+1: y-1
      var el = wave.p(elx, ely)

      var erx = x
      var ery = (y==wave.y-1)? y-1: y+1
      var er = wave.p(erx, ery)
       
      e.a = (eu.p + ed.p + el.p + er.p -4*e.p)* 0.99
      e.a -= e.p * 0.2
    }
  }

  ellipse(50, 50, 80, 80);
  for(var y=0; y< wave.y; ++y){
    stroke(255-255*y/wave.y)
    for(var x=0; x<wave.x; ++x){

//      rect(x*w/wave.x, y*h/wave.y + wave.p(x, y).p, 3, 3)
      if(x==0) continue
      line((x-1)*w/wave.x, y*h/wave.y + wave.p(x-1, y).p, x*w/wave.x, y*h/wave.y + wave.p(x, y).p)


    }
  }
/*  for(var y=0; y<wave.y; ++y){
    stroke( 200*y/wave.y)
    var centy=y*h/wave.y
    for(var x=0; x<wave.x; ++x){
      var centx=x*w/wave.x
      var centx_=(x-1)*w/wave.x
      //rect(cent, wave[i].p+h/2, 3, 3)
      if(x==0) continue
      line(centx, wave.p(x, y).p + centy, centx_, wave.p(x-1, y).p+ centy)
    }
  }
*/
}

console.log("hh")
  </script>

</body>
</html>